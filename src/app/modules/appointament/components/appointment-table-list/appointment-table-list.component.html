<div class="col-12">
  <ng-container *ngIf="dataSource?.length; else loadingState">
    <p-table
      [value]="dataSource"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
      [rowsPerPageOptions]="[10, 25, 50]"
      styleClass="p-datatable-striped"
      [globalFilterFields]="['userId', 'barberId', 'service', 'status', 'userNumber']"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="userId">
            Usuário 
            <p-sortIcon field="userId"></p-sortIcon>
          </th>
          <th pSortableColumn="barberId">
            Barbeiro 
            <p-sortIcon field="barberId"></p-sortIcon>
          </th>
          <th pSortableColumn="date">
            Data 
            <p-sortIcon field="date"></p-sortIcon>
          </th>
          <th pSortableColumn="time">
            Horário 
            <p-sortIcon field="time"></p-sortIcon>
          </th>
          <th pSortableColumn="status">
            Status 
            <p-sortIcon field="status"></p-sortIcon>
          </th>
          <th pSortableColumn="service">
            Serviços 
            <p-sortIcon field="service"></p-sortIcon>
          </th>
          <th>Ações</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-appointment>
        <tr>
          <td>{{ appointment.userId }}</td>
          <td>{{ appointment.barberId }}</td>
          <td>{{ appointment.date | date: 'dd/MM/yyyy' }}</td>
          <td>{{ appointment.time }}</td>
          <td>
            <span 
              class="p-tag"
              [ngClass]="{
                'p-tag-success': appointment.status === 'confirmed',
                'p-tag-warning': appointment.status === 'pending',
                'p-tag-danger': appointment.status === 'cancelled'
              }"
            >
              {{ appointment.status }}
            </span>
          </td>
          <td>
            <span *ngFor="let service of appointment.service; let last = last">
              {{ service }}<span *ngIf="!last">, </span>
            </span>
          </td>
          <td>
            <div class="flex gap-2">
              <p-button
                icon="pi pi-pencil"
                severity="secondary"
                size="small"
                [text]="true"
                (onClick)="onEdit(appointment._id)"
                pTooltip="Editar agendamento"
                tooltipPosition="top"
              ></p-button>
              
              <p-button
                icon="pi pi-trash"
                severity="danger"
                size="small"
                [text]="true"
                (onClick)="onDelete(appointment._id)"
                [loading]="isLoadingDelete"
                pTooltip="Excluir agendamento"
                tooltipPosition="top"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center p-4">
            Nenhum agendamento encontrado
          </td>
        </tr>
      </ng-template>
    </p-table>
  </ng-container>

  <ng-template #loadingState>
    <app-shared-skeleton
      height="48px"
      radius="6px"
      [count]="5"
    ></app-shared-skeleton>
  </ng-template>

  <p-confirmDialog></p-confirmDialog>
</div>

