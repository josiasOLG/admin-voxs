<div class="appointment-services-form">
  <form [formGroup]="servicesForm" class="form-container">
    <h3 class="form-title mb-4">Serviços</h3>

    <div class="grid">
      <!-- Seleção de Serviços -->
      <div class="col-12">
        <div class="flex-col gap-2">
          <label for="service">Serviços *</label>
          <p-multiSelect
            id="service"
            formControlName="service"
            [options]="availableServices()"
            optionLabel="label"
            optionValue="value"
            [filter]="true"
            filterBy="label"
            placeholder="Selecione os serviços"
            [loading]="loadingServices()"
            [class.ng-invalid]="isFieldInvalid('service')"
          />
          <small class="p-error" *ngIf="isFieldInvalid('service')">
            Selecione pelo menos um serviço
          </small>
        </div>
      </div>

      <!-- Resumo dos Serviços Selecionados -->
      <div class="col-12" *ngIf="selectedServicesDetails().length > 0">
        <p-card header="Resumo dos Serviços" styleClass="mt-3">
          <div class="services-summary">
            <div
              class="service-item"
              *ngFor="let service of selectedServicesDetails()"
            >
              <div class="flex justify-content-between align-items-center mb-2">
                <div>
                  <p-tag [value]="service.label" severity="info" />
                  <span class="ml-2 text-600">{{ service.points }} pontos</span>
                </div>
                <span class="text-primary font-semibold"
                  >R$ {{ (+service.money).toFixed(2) }}</span
                >
              </div>
            </div>

            <div class="summary-totals mt-3 pt-3 border-top-1 surface-border">
              <div class="flex justify-content-between mb-2">
                <span class="font-semibold">Pontos Totais:</span>
                <span>{{ getTotalPoints() }} pontos</span>
              </div>
              <div class="flex justify-content-between">
                <span class="font-semibold text-lg">Valor Total:</span>
                <span class="text-primary text-xl font-bold"
                  >R$ {{ getTotalPrice().toFixed(2) }}</span
                >
              </div>
            </div>
          </div>
        </p-card>
      </div>
    </div>

    <!-- Ações -->
    <div class="form-actions mt-4 flex justify-content-between gap-2">
      <p-button
        label="Anterior"
        icon="pi pi-arrow-left"
        severity="secondary"
        [outlined]="true"
        (onClick)="previous()"
      />
      <p-button
        label="Salvar Agendamento"
        icon="pi pi-check"
        iconPos="right"
        (onClick)="save()"
        [loading]="loading()"
      />
    </div>
  </form>
</div>
